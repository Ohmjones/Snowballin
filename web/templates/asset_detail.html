{{define "content"}}
<h1 class="ui inverted header">
    {{if .AssetIconURL}}
    <img class="ui image" src="{{.AssetIconURL}}" alt="{{.AssetPair}} icon" style="width:28px;height:28px;margin-right:8px;border-radius:4px;">
    {{else}}
    <i class="bitcoin icon"></i>
    {{end}}
    <div class="content">
        Asset Detail: {{.AssetPair}}
        <div class="sub header">Live position status, chart, indicators, and consensus.</div>
    </div>
</h1>

<div class="ui two column stackable grid">
    <div class="column">
        <div class="ui inverted raised segment">
            <h4 class="ui inverted header">Chart</h4>
            <div id="tv_chart_container" style="height:420px;"></div>
        </div>

        {{if .Position}}
        <div class="ui inverted raised segment">
            <h4 class="ui inverted header">Position Details</h4>
            <div class="ui inverted relaxed divided list">
                <div class="item"><div class="header">Average Price</div>{{printf "%.8f" .Position.AveragePrice}}</div>
                <div class="item"><div class="header">Volume</div>{{printf "%.6f" .Position.TotalVolume}}</div>
                <div class="item"><div class="header">Unrealized P/L</div>
                    {{if ge .Position.UnrealizedPL 0.0}}
                    <span class="green-number">{{printf "%.2f" .Position.UnrealizedPL}}</span>
                    {{else}}
                    <span class="red-number">{{printf "%.2f" .Position.UnrealizedPL}}</span>
                    {{end}}
                </div>
                <div class="item"><div class="header">Current TP</div>{{printf "%.8f" .Position.CurrentTakeProfit}}</div>
            </div>
        </div>
        {{end}}
    </div>

    <div class="column">
        <div class="ui inverted raised segment">
            <h4 class="ui inverted header">Indicators</h4>
            <div class="ui three stackable cards">
                {{range $k, $v := .IndicatorValues}}
                <div class="ui card">
                    <div class="content">
                        <div class="header">{{$k}}</div>
                        <div class="description">{{$v}}</div>
                    </div>
                </div>
                {{end}}
            </div>
        </div>

        <div class="ui inverted raised segment">
            <h4 class="ui inverted header">Consensus</h4>
            <div class="ui relaxed divided list">
                <div class="item">
                    <i class="chart line icon"></i>
                    <div class="content">
                        <div class="header">Broker</div>
                        {{index .Consensus "broker"}}
                    </div>
                </div>
                {{if (index .Consensus "coingecko")}}
                <div class="item">
                    <i class="leaf icon"></i>
                    <div class="content">
                        <div class="header">CoinGecko</div>
                        {{index .Consensus "coingecko"}}
                    </div>
                </div>
                {{end}}
                {{if (index .Consensus "coinmarketcap")}}
                <div class="item">
                    <i class="chart bar icon"></i>
                    <div class="content">
                        <div class="header">CoinMarketCap</div>
                        {{index .Consensus "coinmarketcap"}}
                    </div>
                </div>
                {{end}}
            </div>
        </div>

        {{if .Analysis}}
        <div class="ui inverted raised segment">
            <h4 class="ui inverted header">Notes</h4>
            <div class="ui bulleted list">
                {{range .Analysis}}<div class="item">{{.}}</div>{{end}}
            </div>
        </div>
        {{end}}
    </div>
</div>

<script type="text/javascript">
    (function() {
        var pair = "{{.AssetPair}}".replace("/", "");
        var symbol = "KRAKEN:" + pair;

        var s = document.createElement('script');
        s.src = "https://s3.tradingview.com/tv.js";
        s.onload = function() {
            new TradingView.widget({
                container_id: "tv_chart_container",
                symbol: symbol,
                interval: "60",
                timezone: "Etc/UTC",
                theme: "dark",
                style: "1",
                locale: "en",
                enable_publishing: false,
                allow_symbol_change: false,
                autosize: true,
                hide_top_toolbar: false,
                hide_legend: false
            });
        };
        document.body.appendChild(s);
    })();
</script>
{{end}}
