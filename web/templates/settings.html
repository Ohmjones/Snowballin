{{define "content"}}
<h1 class="ui inverted header">
    <i class="cogs icon"></i>
    <div class="content">
        Configuration Settings
        <div class="sub header">Modify bot settings on-the-fly. Changes are saved and applied to the next trading cycle.</div>
    </div>
</h1>

{{if .PageData.Message}}
<div class="ui success message">
    <i class="close icon"></i>
    <div class="header">Update Successful</div>
    <p>{{.PageData.Message}}</p>
</div>
{{end}}

<form class="ui inverted form" method="POST" action="/settings">

    <div class="ui inverted raised segment">
        <h4 class="ui dividing inverted header">Core Trading Parameters</h4>
        <p>The main parameters that define the bot's trading behavior and risk.</p>

        <div class="field">
            <label>Asset Pairs <i class="info circle icon" data-content="Comma-separated list of cryptocurrency pairs the bot is allowed to trade (e.g., BTC/USD,ETH/USD)."></i></label>
            <input type="text" name="trading.asset_pairs" value="{{join .PageData.Config.Trading.AssetPairs `,`}}">
        </div>

        <div class="four fields">
            <div class="field">
                <label>Portfolio Risk / Trade (%) <i class="info circle icon" data-content="The maximum percentage of the total portfolio to be risked on any single trade."></i></label>
                <input type="text" name="trading.portfolio_risk_per_trade" value="{{.PageData.Config.Trading.PortfolioRiskPerTrade}}">
            </div>
            <div class="field">
                <label>Base Order Size ({{.PageData.Config.Trading.QuoteCurrency}}) <i class="info circle icon" data-content="The initial order size in the quote currency for a new trade."></i></label>
                <input type="text" name="trading.base_order_size" value="{{.PageData.Config.Trading.BaseOrderSize}}">
            </div>
            <div class="field">
                <label>Take Profit (%) <i class="info circle icon" data-content="The percentage of profit at which the bot should aim to close a position."></i></label>
                <input type="text" name="trading.take_profit_percentage" value="{{.PageData.Config.Trading.TakeProfitPercentage}}">
            </div>
            <div class="field">
                <label>Partial Sell at TP (%) <i class="info circle icon" data-content="The percentage of a position to sell when the initial take-profit target is hit."></i></label>
                <input type="text" name="trading.take_profit_partial_sell_percent" value="{{.PageData.Config.Trading.TakeProfitPartialSellPercent}}">
            </div>
        </div>
    </div>

    <div class="ui inverted raised segment">
        <h4 class="ui dividing inverted header">DCA Safety Orders</h4>
        <p>Parameters for the Dollar Cost Averaging (DCA) strategy if the price moves against an open position.</p>

        <div class="four fields">
            <div class="field">
                <label>Max Safety Orders <i class="info circle icon" data-content="The maximum number of safety orders the bot can place for a single deal."></i></label>
                <input type="text" name="trading.max_safety_orders" value="{{.PageData.Config.Trading.MaxSafetyOrders}}">
            </div>
            <div class="field">
                <label>Price Deviation for SO (%) <i class="info circle icon" data-content="The percentage the price must drop below the previous order to place a new safety order."></i></label>
                <input type="text" name="trading.price_deviation_to_open_safety_orders" value="{{.PageData.Config.Trading.PriceDeviationToOpenSafetyOrders}}">
            </div>
            <div class="field">
                <label>SO Step Scale <i class="info circle icon" data-content="A multiplier that increases the price deviation for each subsequent safety order, spacing them further apart."></i></label>
                <input type="text" name="trading.safety_order_step_scale" value="{{.PageData.Config.Trading.SafetyOrderStepScale}}">
            </div>
            <div class="field">
                <label>SO Volume Scale <i class="info circle icon" data-content="A multiplier that increases the size of each subsequent safety order."></i></label>
                <input type="text" name="trading.safety_order_volume_scale" value="{{.PageData.Config.Trading.SafetyOrderVolumeScale}}">
            </div>
        </div>
    </div>

    <div class="ui inverted raised segment">
        <h4 class="ui dividing inverted header">Trailing Stop</h4>
        <p>Protects gains by having the stop-loss price follow the market price upwards.</p>
        <div class="two fields">
            <div class="field">
                <div class="ui toggle checkbox">
                    <input type="checkbox" name="trading.trailing_stop_enabled" value="on" {{if .PageData.Config.Trading.TrailingStopEnabled}}checked{{end}}>
                    <label style="color:white;">Enable Trailing Stop <i class="info circle icon" data-content="Enables or disables the trailing stop loss feature."></i></label>
                </div>
            </div>
            <div class="field">
                <label>Trailing Stop Deviation (%) <i class="info circle icon" data-content="The percentage the price must drop from its peak for the trailing stop to trigger a sale."></i></label>
                <input type="text" name="trading.trailing_stop_deviation" value="{{.PageData.Config.Trading.TrailingStopDeviation}}">
            </div>
        </div>
    </div>

    <div class="ui inverted raised segment">
        <h4 class="ui dividing inverted header">Indicators</h4>
        <p>Parameters for the technical indicators used to analyze market conditions.</p>

        <div class="six fields">
            <div class="field">
                <label>RSI Period <i class="info circle icon" data-content="The lookback period (number of candles) for calculating the Relative Strength Index (RSI)."></i></label>
                <input type="text" name="indicators.rsi_period" value="{{.PageData.Config.Indicators.RSIPeriod}}">
            </div>
            <div class="field">
                <label>ATR Period <i class="info circle icon" data-content="The lookback period for the Average True Range (ATR) volatility indicator."></i></label>
                <input type="text" name="indicators.atr_period" value="{{.PageData.Config.Indicators.ATRPeriod}}">
            </div>
            <div class="field">
                <label>MACD Fast <i class="info circle icon" data-content="The lookback period for the fast-moving average in the MACD indicator."></i></label>
                <input type="text" name="indicators.macd_fast_period" value="{{.PageData.Config.Indicators.MACDFastPeriod}}">
            </div>
            <div class="field">
                <label>MACD Slow <i class="info circle icon" data-content="The lookback period for the slow-moving average in the MACD indicator."></i></label>
                <input type="text" name="indicators.macd_slow_period" value="{{.PageData.Config.Indicators.MACDSlowPeriod}}">
            </div>
            <div class="field">
                <label>MACD Signal <i class="info circle icon" data-content="The lookback period for the signal line's moving average in the MACD indicator."></i></label>
                <input type="text" name="indicators.macd_signal_period" value="{{.PageData.Config.Indicators.MACDSignalPeriod}}">
            </div>
            <div class="field">
                <label>Stoch RSI Buy <i class="info circle icon" data-content="The Stochastic RSI level below which a buy signal is considered (oversold territory)."></i></label>
                <input type="text" name="indicators.stoch_rsi_buy_threshold" value="{{.PageData.Config.Indicators.StochRSIBuyThreshold}}">
            </div>
        </div>
    </div>

    <div class="ui inverted raised segment">
        <h4 class="ui dividing inverted header">Safety & Logging</h4>
        <p>Master risk controls and application logging verbosity.</p>

        <div class="two fields">
            <div class="field">
                <div class="ui toggle checkbox">
                    <input type="checkbox" name="circuitbreaker.enabled" value="on" {{if .PageData.Config.CircuitBreaker.Enabled}}checked{{end}}>
                    <label style="color:white;">Enable Circuit Breaker <i class="info circle icon" data-content="Halts all trading if the portfolio drawdown exceeds the defined threshold."></i></label>
                </div>
            </div>
            <div class="field">
                <label>Circuit Breaker Drawdown (%) <i class="info circle icon" data-content="The maximum portfolio drawdown percentage that will trigger the circuit breaker."></i></label>
                <input type="text" name="circuitbreaker.drawdown_threshold_percent" value="{{.PageData.Config.CircuitBreaker.DrawdownThresholdPercent}}">
            </div>
        </div>
        <div class="field">
            <label>Log Level <i class="info circle icon" data-content="Sets the minimum level of messages to be logged."></i></label>
            <select name="logging.level" class="ui dropdown">
                <option value="debug" {{if eq .PageData.Config.Logging.Level `debug`}}selected{{end}}>Debug</option>
                <option value="info" {{if eq .PageData.Config.Logging.Level `info`}}selected{{end}}>Info</option>
                <option value="warn" {{if eq .PageData.Config.Logging.Level `warn`}}selected{{end}}>Warn</option>
                <option value="error" {{if eq .PageData.Config.Logging.Level `error`}}selected{{end}}>Error</option>
            </select>
        </div>
    </div>

    <div class="ui divider"></div>
    <button class="ui positive button" type="submit">Save and Apply Settings</button>
</form>

<script>
    // Make sure the DOM is fully loaded before running scripts
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Semantic UI popups for the info icons
        $('.info.circle.icon').popup();
        // Initialize dropdowns
        $('.ui.dropdown').dropdown();
        // Initialize checkboxes
        $('.ui.checkbox').checkbox();
        // Initialize success message close icon
        $('.message .close').on('click', function() {
            $(this).closest('.message').transition('fade');
        });
    });
</script>
{{end}}